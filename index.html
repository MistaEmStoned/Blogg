<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Marco's Blog</title>
<meta name="description" content="A simple personal blog template. Edit posts in the browser.">
<style>
:root{--max:1000px;--accent:#2563eb;--muted:#6b7280}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;color:#111;background:#f7f7f8}
.wrap{max-width:var(--max);margin:28px auto;padding:18px}
header{display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:12px}
.logo {
  width:56px;
  height:56px;
  border-radius:8px;
  background:linear-gradient(135deg,#2563eb,#06b6d4);
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-weight:700;
  font-size:20px;
}
nav a{margin-left:14px;color:var(--muted);text-decoration:none;font-weight:600}
.hero{display:grid;grid-template-columns:1fr 320px;gap:20px;margin-top:18px}
.card{background:white;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
.post{margin-bottom:14px}
.post h3{margin:0 0 6px 0}
.meta{color:var(--muted);font-size:13px;margin-bottom:8px}
.excerpt{color:#374151;font-size:15px;line-height:1.45}
.sidebar h4{margin-top:0}
.new-post{display:flex;flex-direction:column;gap:8px}
input[type=text],textarea{width:100%;padding:10px;border:1px solid #e6e7ea;border-radius:8px;font-size:14px}
button{background:var(--accent);color:white;border:0;padding:10px 12px;border-radius:8px;font-weight:700;cursor:pointer}
footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
#newPostBtn{display:none;position:fixed;bottom:20px;right:20px;padding:12px 16px;background:var(--accent);color:white;border:none;border-radius:8px;font-weight:700;cursor:pointer;z-index:1000}
#mobileModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.4);align-items:center;justify-content:center;z-index:1000}
#mobileModal .modalContent{background:white;border-radius:12px;padding:18px;width:90%;max-width:400px;display:flex;flex-direction:column;gap:8px}
@media (max-width:880px){.hero{grid-template-columns:1fr}.logo{width:48px;height:48px} #newPostBtn{display:block} .sidebar{display:none}}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
</head>
<body>
<div class="wrap">
<header>
  <div class="brand">
    <div class="logo">BG</div>
<div style="font-weight:800;font-size:18px">BLOGG</div>
      <div style="color:var(--muted);font-size:13px">Notes on stuff, thoughts, life</div>
    </div>
  </div>
  <nav>
    <a href="#" id="loginBtn">Sign In</a>
  </nav>
</header>

<main class="hero">
  <section>
    <div class="card" id="posts">
      <h2 style="margin-top:0">Latest posts</h2>
    </div>
  </section>

  <aside class="sidebar">
    <div class="card">
      <h4>New post</h4>
      <div class="new-post">
        <input id="authorName" type="text" placeholder="Your name">
        <input id="title" type="text" placeholder="Post title">
        <textarea id="content" rows="6" placeholder="Write your post here"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button id="saveBtn">Publish</button>
        </div>
        <div style="font-size:13px;color:var(--muted);margin-top:8px">Posts save to Firebase. Only you can edit/delete your own posts.</div>
      </div>
    </div>
  </aside>
</main>

<footer>
  <div style="margin-top:10px">© <span id="year"></span> Marco Sarmiento</div>
</footer>
</div>

<button id="newPostBtn">New Post</button>

<div id="mobileModal">
  <div class="modalContent">
    <input id="mobileAuthor" type="text" placeholder="Your name">
    <input id="mobileTitle" type="text" placeholder="Post title">
    <textarea id="mobileContent" rows="6" placeholder="Write your post here"></textarea>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button id="mobileCancel">Cancel</button>
      <button id="mobileSave">Publish</button>
    </div>
  </div>
</div>

<script>
const yearEl = document.getElementById('year');
yearEl.textContent = new Date().getFullYear();

// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCJjhkq3KdB65hxp6-95fbgbwzWpWAucbI",
  authDomain: "blogg-b66ef.firebaseapp.com",
  projectId: "blogg-b66ef",
  storageBucket: "blogg-b66ef.firebasestorage.app",
  messagingSenderId: "866277401593",
  appId: "1:866277401593:web:324161cdeb92f09fd29328",
  measurementId: "G-N6Y00ZNR3J"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

const postsEl = document.getElementById('posts');
const titleEl = document.getElementById('title');
const contentEl = document.getElementById('content');
const authorEl = document.getElementById('authorName');

const mobileModal = document.getElementById('mobileModal');
const mobileTitle = document.getElementById('mobileTitle');
const mobileContent = document.getElementById('mobileContent');
const mobileAuthor = document.getElementById('mobileAuthor');
const mobileSave = document.getElementById('mobileSave');
const mobileCancel = document.getElementById('mobileCancel');

const loginBtn = document.getElementById('loginBtn');

document.getElementById('newPostBtn').addEventListener('click',()=>mobileModal.style.display='flex');
mobileCancel.addEventListener('click',()=>mobileModal.style.display='none');

function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}

function renderPosts(posts, currentUid){
  postsEl.innerHTML = '<h2 style="margin-top:0">Latest posts</h2>';
  posts.forEach(p=>{
    const wrap = document.createElement('article');
    wrap.className='post card';
    const date = new Date(p.date);
    const formattedDate = date.toLocaleString();
    wrap.innerHTML=`
      <h3>${escapeHtml(p.title)}</h3>
      <div class="meta">${formattedDate} · ${escapeHtml(p.authorName)}</div>
      <div class="excerpt">${escapeHtml(p.content).slice(0,160)}</div>
      <div style="margin-top:8px">
        ${p.authorId===currentUid ? `<button data-id="${p.id}" class="del" style="background:#ef4444">Delete</button>` : ''}
        <button data-id="${p.id}" class="open">Read</button>
      </div>
    `;
    postsEl.appendChild(wrap);
  });
}

auth.onAuthStateChanged(user=>{
  if(!user) return;
  const uid = user.uid;

  loginBtn.textContent = 'Sign Out';
  loginBtn.onclick = ()=>auth.signOut();

  function fetchAndRender(){
    db.collection('posts').orderBy('date','desc').get().then(snapshot=>{
      const posts = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
      renderPosts(posts, uid);
    });
  }

  fetchAndRender();

  function saveHandler(titleEl, contentEl, authorEl){
    const title = titleEl.value.trim();
    const content = contentEl.value.trim();
    const authorName = authorEl.value.trim() || 'Anonymous';
    if(!title || !content){ alert('Title and content required'); return; }

    const postData = { title, content, authorName, authorId: uid, date: new Date().toISOString() };
    db.collection('posts').add(postData).then(()=>{
      titleEl.value=''; contentEl.value='';
      if(titleEl === mobileTitle) mobileModal.style.display='none';
      fetchAndRender();
    });
  }

  document.getElementById('saveBtn').addEventListener('click',()=>saveHandler(titleEl, contentEl, authorEl));
  mobileSave.addEventListener('click',()=>saveHandler(mobileTitle, mobileContent, mobileAuthor));

  postsEl.addEventListener('click',e=>{
    const id = e.target.dataset.id;
    if(!id) return;
    if(e.target.classList.contains('del')){
      db.collection('posts').doc(id).get().then(doc=>{
        if(doc.exists && doc.data().authorId===uid){
          db.collection('posts').doc(id).delete().then(fetchAndRender);
        }
      });
      return;
    }
    if(e.target.classList.contains('open')){
      db.collection('posts').doc(id).get().then(doc=>{
        if(doc.exists) showModal(doc.data());
      });
    }
  });
});

// Google login
loginBtn.addEventListener('click',()=>{
  if(auth.currentUser) return auth.signOut();
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
});

function showModal(p){
  const modal = document.createElement('div');
  modal.style.position='fixed';
  modal.style.inset=0;
  modal.style.display='flex';
  modal.style.alignItems='center';
  modal.style.justifyContent='center';
  modal.style.background='rgba(0,0,0,0.4)';
  const date = new Date(p.date);
  const formattedDate = date.toLocaleString();
  modal.innerHTML = `
    <div style="max-width:720px;width:92%;background:white;border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.3)">
      <h2 style="margin-top:0">${escapeHtml(p.title)}</h2>
      <div style="color:var(--muted);margin-bottom:8px">${formattedDate} · ${escapeHtml(p.authorName)}</div>
      <div style="color:#111;font-size:15px;line-height:1.6">${escapeHtml(p.content).replace(/\n/g,'<br>')}</div>
      <div style="text-align:right;margin-top:16px"><button id="closeModal">Close</button></div>
    </div>
  `;
  document.body.appendChild(modal);
  document.getElementById('closeModal').addEventListener('click',()=>modal.remove());
}
</script>
</body>
</html>};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

const postsEl = document.getElementById('posts');
const titleEl = document.getElementById('title');
const contentEl = document.getElementById('content');
const authorEl = document.getElementById('authorName');

const mobileModal = document.getElementById('mobileModal');
const mobileTitle = document.getElementById('mobileTitle');
const mobileContent = document.getElementById('mobileContent');
const mobileAuthor = document.getElementById('mobileAuthor');
const mobileSave = document.getElementById('mobileSave');
const mobileCancel = document.getElementById('mobileCancel');

const loginBtn = document.getElementById('loginBtn');

document.getElementById('newPostBtn').addEventListener('click',()=>mobileModal.style.display='flex');
mobileCancel.addEventListener('click',()=>mobileModal.style.display='none');

function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}

function renderPosts(posts, currentUid){
  postsEl.innerHTML = '<h2 style="margin-top:0">Latest posts</h2>';
  posts.forEach(p=>{
    const wrap = document.createElement('article');
    wrap.className='post card';
    const date = new Date(p.date);
    const formattedDate = date.toLocaleString();
    wrap.innerHTML=`
      <h3>${escapeHtml(p.title)}</h3>
      <div class="meta">${formattedDate} · ${escapeHtml(p.authorName)}</div>
      <div class="excerpt">${escapeHtml(p.content).slice(0,160)}</div>
      <div style="margin-top:8px">
        ${p.authorId===currentUid ? `<button data-id="${p.id}" class="del" style="background:#ef4444">Delete</button>` : ''}
        <button data-id="${p.id}" class="open">Read</button>
      </div>
    `;
    postsEl.appendChild(wrap);
  });
}

auth.onAuthStateChanged(user=>{
  if(!user) return;
  const uid = user.uid;

  loginBtn.textContent = 'Sign Out';
  loginBtn.onclick = ()=>auth.signOut();

  function fetchAndRender(){
    db.collection('posts').orderBy('date','desc').get().then(snapshot=>{
      const posts = snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));
      renderPosts(posts, uid);
    });
  }

  fetchAndRender();

  function saveHandler(titleEl, contentEl, authorEl){
    const title = titleEl.value.trim();
    const content = contentEl.value.trim();
    const authorName = authorEl.value.trim() || 'Anonymous';
    if(!title || !content){ alert('Title and content required'); return; }

    const postData = { title, content, authorName, authorId: uid, date: new Date().toISOString() };
    db.collection('posts').add(postData).then(()=>{
      titleEl.value=''; contentEl.value='';
      if(titleEl === mobileTitle) mobileModal.style.display='none';
      fetchAndRender();
    });
  }

  document.getElementById('saveBtn').addEventListener('click',()=>saveHandler(titleEl, contentEl, authorEl));
  mobileSave.addEventListener('click',()=>saveHandler(mobileTitle, mobileContent, mobileAuthor));

  postsEl.addEventListener('click',e=>{
    const id = e.target.dataset.id;
    if(!id) return;
    if(e.target.classList.contains('del')){
      db.collection('posts').doc(id).get().then(doc=>{
        if(doc.exists && doc.data().authorId===uid){
          db.collection('posts').doc(id).delete().then(fetchAndRender);
        }
      });
      return;
    }
    if(e.target.classList.contains('open')){
      db.collection('posts').doc(id).get().then(doc=>{
        if(doc.exists) showModal(doc.data());
      });
    }
  });
});

// Google login
loginBtn.addEventListener('click',()=>{
  if(auth.currentUser) return auth.signOut();
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
});

function showModal(p){
  const modal = document.createElement('div');
  modal.style.position='fixed';
  modal.style.inset=0;
  modal.style.display='flex';
  modal.style.alignItems='center';
  modal.style.justifyContent='center';
  modal.style.background='rgba(0,0,0,0.4)';
  const date = new Date(p.date);
  const formattedDate = date.toLocaleString();
  modal.innerHTML = `
    <div style="max-width:720px;width:92%;background:white;border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.3)">
      <h2 style="margin-top:0">${escapeHtml(p.title)}</h2>
      <div style="color:var(--muted);margin-bottom:8px">${formattedDate} · ${escapeHtml(p.authorName)}</div>
      <div style="color:#111;font-size:15px;line-height:1.6">${escapeHtml(p.content).replace(/\n/g,'<br>')}</div>
      <div style="text-align:right;margin-top:16px"><button id="closeModal">Close</button></div>
    </div>
  `;
  document.body.appendChild(modal);
  document.getElementById('closeModal').addEventListener('click',()=>modal.remove());
}
</script>
</body>
</html>


